<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CCAFE CC-GWAS Example • CCAFE</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="CCAFE CC-GWAS Example">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CCAFE</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.99.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/CCAFE.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/CCAFE_CCGWAS.html">CCAFE CC-GWAS Example</a>
    </li>
    <li>
      <a href="../articles/CCAFE_Extra_Details.html">CCAFE Extra Details</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/wolffha/CCAFE/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>CaseControlAF_ccGWAS</h1>
                        <h4 data-toc-skip class="author">Hayley
Stoneman</h4>
            
            <h4 data-toc-skip class="date">2024-09-12</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/wolffha/CCAFE/blob/HEAD/vignettes/articles/CCAFE_CCGWAS.Rmd" class="external-link"><code>vignettes/articles/CCAFE_CCGWAS.Rmd</code></a></small>
      <div class="hidden name"><code>CCAFE_CCGWAS.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/wolffha/CCAFE/" class="external-link">CCAFE</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction-and-motivation">Introduction and motivation<a class="anchor" aria-label="anchor" href="#introduction-and-motivation"></a>
</h2>
<p>In this vignette, I will demonstrate the workflow for using the R
package <em>CaseControlAF</em> and perform secondary analyses using the
output case and control AFs. Here, the secondary analysis will be a
case-case GWAS (CC-GWAS). Additional details of CC-GWAS can be found in
Chapter I: INTRODUCTION.</p>
<div class="section level3">
<h3 id="brief-overview-of-cc-gwas">Brief overview of CC-GWAS<a class="anchor" aria-label="anchor" href="#brief-overview-of-cc-gwas"></a>
</h3>
<p>Briefly, CC-GWAS identifies genetic variants that have different AFs
between two samples of cases with related (but different) traits or
diseases. This could provide insight as to why a person might develop
one trait instead of a closely related second trait. CC-GWAS was first
introduced by Peyrot and Price in 2021. A second alternative framework
to perform CC-GWAS was proposed by Yang <em>et al.</em> in 2022. Yang
<em>et al</em> provided C-based software to perform this analysis as
part of a larger software package called <em>ReACt</em>. I have adapted
their code and framework and implemented it in R.</p>
<p>In this framework a logistic regression is run using only the AFs
from the two case samples. However, it is important to differentiate the
effects from trait-trait differences and population stratification. In
this logistic regression of the two case samples, the effect sizes
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>β</mi><mn>1</mn><mrow><mi>c</mi><mi>a</mi><mi>s</mi><mi>e</mi></mrow></msubsup><annotation encoding="application/x-tex">\beta_1^{case}</annotation></semantics></math>
will include real genetic differences between trait 1 and trait 2
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>β</mi><mi>g</mi></msub><annotation encoding="application/x-tex">\beta_g</annotation></semantics></math>)
as well as differences due to population stratification
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>β</mi><mi>s</mi></msub><annotation encoding="application/x-tex">\beta_s</annotation></semantics></math>).
We assume that these two effects are independent such that:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>β</mi><mn>1</mn><mrow><mi>c</mi><mi>a</mi><mi>s</mi><mi>e</mi></mrow></msubsup><mo>=</mo><msub><mi>β</mi><mi>g</mi></msub><mo>+</mo><msub><mi>β</mi><mi>s</mi></msub></mrow><annotation encoding="application/x-tex"> \beta_1^{case} = \beta_g + \beta_s </annotation></semantics></math>
To isolate the true trait-trait genetic differences, a regression
between the two controls samples is run, to get an estimate of the
stratification effect
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>β</mi><mi>s</mi></msub><annotation encoding="application/x-tex">\beta_s</annotation></semantics></math>.
Note that we also get a standard error for the estimate of
stratification, and this can be used to remove variants for which the
stratification effect cannot be reliably estimated.</p>
<p>The genetic effect from the trait-trait difference can then be
obtained:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>β</mi><mi>g</mi></msub><mo>=</mo><msubsup><mi>β</mi><mn>1</mn><mrow><mi>c</mi><mi>a</mi><mi>s</mi><mi>e</mi></mrow></msubsup><mo>−</mo><msub><mi>β</mi><mi>s</mi></msub></mrow><annotation encoding="application/x-tex"> \beta_g = \beta_1^{case} - \beta_s </annotation></semantics></math>
These case and control logistic regressions are carried out using the
case and control genotype counts and the binary phenotype. Here I will
compare the known case and control genotype counts (included in the
summary statistics), those estimated using the SE (CaseControl_SE) and
those estimated using total AF (CaseControl_AF).</p>
</div>
</div>
<div class="section level2">
<h2 id="datasets">Datasets<a class="anchor" aria-label="anchor" href="#datasets"></a>
</h2>
<p>I will be using GWAS summary statistics from the All of Us Research
Program All by All (AllxAll) tables. The All of Us Research Program
recently made available to the Controlled Tier Access researchers the
results from GWAS for thousands of phenotypes from the ~250,000
participants who have whole genome sequence data available. The AllxAll
tables include the results of association testing for ~3,4000 phenotypes
including physical measurements, lab measurements, phecodes, and
electronic health record (EHR) sourced drugs and medications. The data
is available in Hail Matrix Tables with the summary statistics by
individual ancestry or following meta-analysis. Find more information
about the AllxAll results <a href="https://support.researchallofus.org/hc/en-us/articles/27049847988884-Overview-of-the-All-by-All-tables-available-on-the-All-of-Us-Researcher-Workbench" class="external-link">here</a></p>
<p>In the original CC-GWAS paper by Peyrot and Price 2021, psychiatric
traits were compared, including Schizophrenia (SZ) and Bipolar Disease
(BP). Yang <em>et al</em> 2022 also compared these two traits.</p>
<p>In All of Us, GWAS was run for SZ (Phecode 295.1), with 584 cases and
98,402 controls. GWAS for BP (Phecode 296.1) was run with 2,865 cases
and 92,758 controls. These two Phecodes exclude other psychiatric trait
ICD codes in their case definitions, so there should be no overlap
between case samples in the two traits. Here I will query the
association summary statistics for these two GWAS, including the total
AF, true case and control AFs, beta/OR, and SE of the log(OR).</p>
<div class="section level3">
<h3 id="obtain-datasets-from-all-of-us-researcher-workbench">Obtain datasets from All of Us Researcher Workbench<a class="anchor" aria-label="anchor" href="#obtain-datasets-from-all-of-us-researcher-workbench"></a>
</h3>
<p>Here I will show the code used to obtain the summary statistics from
these GWAS from the AllxAll tables. I obtain the case and control sample
size, the case and control AFs, the total AF and allele count (AC), and
the variant ID, beta, and SE values for each variant. Note that this
code must be run through the Researcher Workbench after obtaining
Controlled Tier Access. I am only showing the code used to obtain the BP
data set (phenoname = 296.1), though the steps are identical just with a
different phenotype name for SZ (phenoname = 295.1). The Researcher
Workbench uses Jupyter Notebooks running Python 3.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># setting up packages </span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime </span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="im">import</span> os </span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="im">import</span> gc </span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a> </span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co">#for data handling and storage </span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="im">import</span> subprocess </span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np </span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd </span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a> </span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>start <span class="op">=</span> datetime.now() </span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a> </span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a><span class="co"># loading bokeh to show hail plots </span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="im">from</span> bokeh.resources <span class="im">import</span> INLINE </span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a><span class="im">import</span> bokeh.io </span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a><span class="im">from</span> bokeh <span class="im">import</span> <span class="op">*</span> </span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>bokeh.io.output_notebook(INLINE) </span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a><span class="im">from</span> bokeh.io <span class="im">import</span> show, output_notebook </span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a> </span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a><span class="co"># Google cloud resources </span></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a><span class="im">from</span> google.cloud <span class="im">import</span> storage </span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a> </span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a><span class="co"># initializing hail </span></span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a><span class="co"># setting hail tmp directory to WORKSPACE_BUCKET. This prevents hail to use HDFS and a risk of </span></span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a><span class="co"># running out of space </span></span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a><span class="co"># if there is not enough space on non-preemptible workers </span></span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a><span class="co"># this may slow down I/O of large files but prevents scripts from crushing </span></span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a><span class="im">import</span> hail <span class="im">as</span> hl </span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a>hl.init(default_reference <span class="op">=</span> <span class="st">"GRCh38"</span>) </span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" tabindex="-1"></a>bucket <span class="op">=</span> os.getenv(<span class="st">'WORKSPACE_BUCKET'</span>) </span></code></pre></div>
<p>Read in Hail matrix table for the ACAF (single variant) data. I am
using the EUR only data due to the small sample size.</p>
<p><em>SZ</em></p>
<ul>
<li>Cases EUR = 584</li>
<li>Controls EUR = 98,402</li>
</ul>
<p><em>BP</em></p>
<ul>
<li>Cases EUR = 2,865 cases</li>
<li>Controls EUR = 92,758</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>all_EUR <span class="op">=</span> hl.read_matrix_table(“gs:<span class="op">//</span>fc<span class="op">-</span>aou<span class="op">-</span>datasets<span class="op">-</span>controlled<span class="op">/</span>AllxAll<span class="op">/</span>v1<span class="op">/</span>mt<span class="op">/</span>EUR_ACAF_results.mt”) </span></code></pre></div>
<p>Subset the data to only the desired phenotype by phenoname</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>Pheno <span class="op">=</span> “<span class="fl">296.1</span>” </span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>Bp_EUR <span class="op">=</span> all_EUR.filter_cols(all_EUR.phenoname <span class="op">==</span> Pheno) </span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>Bp_EUR <span class="op">=</span> Bp_EUR.entries() </span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="co"># View the data set </span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>Bp_EUR.show() </span></code></pre></div>
<p>Subset to only the desired columns</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>Bp_EUR_sub <span class="op">=</span> bp_EUR.select(<span class="st">'variant_id'</span>, <span class="st">'n_cases'</span>, <span class="st">'n_controls'</span>, <span class="st">'BETA'</span>, <span class="st">'SE'</span>, <span class="st">'AF_case'</span>, </span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="st">'AF_ctrl'</span>, <span class="st">'AF_Allele2'</span>, <span class="st">'AC_Allele2'</span>) </span></code></pre></div>
<p>Export the data to your Google bucket</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>Bp_path <span class="op">=</span> f’{bucket}<span class="op">/</span>data<span class="op">/</span>pheno_ENTERNAMEHERE.tsv.bgz’ </span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>Bp_EUR_sub.export(Bp_path) </span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="source-code">Source code<a class="anchor" aria-label="anchor" href="#source-code"></a>
</h2>
<p>Here is the source code used to perform the CC-GWAS and generate
plots. The CC-GWAS code and helper functions have been adapted from the
ReACt software, which was original written in C. The code can be found
<a href="https://github.com/Paschou-Lab/ReAct" class="external-link">here</a>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Helper functions</span></span>
<span></span>
<span><span class="co"># Function to calculate the p-value of a wald statistic assuming normal distribution</span></span>
<span><span class="va">calc_waldP</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">beta</span>, <span class="va">SE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">beta</span><span class="op">/</span><span class="va">SE</span><span class="op">)</span></span>
<span>  <span class="va">p_val</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">p_val</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># function to calculate OR, SE, and p-value using a 2x2 table</span></span>
<span><span class="co"># assumed to be using the AF of trait 1, AF of trait 2, and sample sizes</span></span>
<span><span class="co"># DefFac is used to scale the allele counts calculated based on sample overlap</span></span>
<span><span class="va">calc_ORStat</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">AF1</span>, <span class="va">N1</span>, <span class="va">AF2</span>, <span class="va">N2</span>, <span class="va">DefFac</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># first calculate the 2x2 tables of allele counts</span></span>
<span>  <span class="va">a</span> <span class="op">=</span> <span class="va">AF1</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">N1</span> <span class="op">*</span> <span class="va">DefFac</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">b</span> <span class="op">=</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">AF1</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">N1</span> <span class="op">*</span> <span class="va">DefFac</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">c</span> <span class="op">=</span> <span class="va">AF2</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">N2</span> <span class="op">*</span> <span class="va">DefFac</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">d</span> <span class="op">=</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">AF2</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">N2</span> <span class="op">*</span> <span class="va">DefFac</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">OR</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">a</span><span class="op">*</span><span class="va">d</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">b</span><span class="op">*</span><span class="va">c</span><span class="op">)</span></span>
<span>  <span class="va">SE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">a</span> <span class="op">+</span> <span class="fl">1</span><span class="op">/</span><span class="va">b</span> <span class="op">+</span> <span class="fl">1</span><span class="op">/</span><span class="va">c</span> <span class="op">+</span> <span class="fl">1</span><span class="op">/</span><span class="va">d</span><span class="op">)</span></span>
<span>  <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">calc_waldP</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">OR</span><span class="op">)</span>, <span class="va">SE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>OR <span class="op">=</span> <span class="va">OR</span>, SE <span class="op">=</span> <span class="va">SE</span>, p <span class="op">=</span> <span class="va">p</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">get_z</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">OR1</span>, <span class="va">OR2</span>, <span class="va">SE1</span>, <span class="va">SE2</span>, <span class="va">Zthres</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">N12</span> <span class="op">=</span> <span class="fl">0</span> <span class="co"># number of times Z1 and Z2 both non zero</span></span>
<span>  <span class="va">SumZ12</span> <span class="op">=</span> <span class="fl">0</span> <span class="co"># sum of Z1*Z2</span></span>
<span>  <span class="va">SqrSumZ1</span> <span class="op">=</span> <span class="fl">0</span> <span class="co"># sum of Z1^2</span></span>
<span>  <span class="va">SqrSumZ2</span> <span class="op">=</span> <span class="fl">0</span> <span class="co"># sum of Z2^2</span></span>
<span>  </span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">OR1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># set z to Log(OR)/SE as long as OR != 0, else set it to 0</span></span>
<span>    <span class="va">z1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">OR1</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">*</span><span class="va">SE1</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">!=</span> <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">OR1</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="va">SE1</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fl">0.0</span><span class="op">)</span></span>
<span>    <span class="va">z2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">OR2</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">*</span><span class="va">SE2</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">!=</span> <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">OR2</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="va">SE2</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fl">0.0</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># if |z| &gt; zthreshold set to zero</span></span>
<span>    <span class="va">z1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">z1</span> <span class="op">&gt;</span> <span class="va">Zthres</span>, <span class="fl">0.0</span>, <span class="va">z1</span><span class="op">)</span></span>
<span>    <span class="va">z2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">z2</span> <span class="op">&gt;</span> <span class="va">Zthres</span>, <span class="fl">0.0</span>, <span class="va">z2</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># if product is not zero then update z square values</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">z1</span><span class="op">*</span><span class="va">z2</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">N12</span> <span class="op">&lt;-</span> <span class="va">N12</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>      <span class="va">SumZ12</span> <span class="op">&lt;-</span> <span class="va">SumZ12</span> <span class="op">+</span> <span class="va">z1</span><span class="op">*</span><span class="va">z2</span></span>
<span>      <span class="va">SqrSumZ1</span> <span class="op">&lt;-</span> <span class="va">SqrSumZ1</span> <span class="op">+</span> <span class="va">z1</span><span class="op">^</span><span class="fl">2</span></span>
<span>      <span class="va">SqrSumZ2</span> <span class="op">&lt;-</span> <span class="va">SqrSumZ2</span> <span class="op">+</span> <span class="va">z2</span><span class="op">^</span><span class="fl">2</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">N12</span>, <span class="va">SumZ12</span>, <span class="va">SqrSumZ1</span>, <span class="va">SqrSumZ2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># helper function to calculate log-likelihood for a bivariate normal distribution given the correlation coefficient rho and total smaple size N</span></span>
<span><span class="va">calc_logLikelihood</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x2</span>, <span class="va">y2</span>, <span class="va">xy</span>, <span class="va">rho</span>, <span class="va">N</span>, <span class="va">Zthres</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">l_0</span> <span class="op">&lt;-</span> <span class="op">-</span> <span class="va">N</span><span class="op">/</span><span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">rho</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="va">x2</span> <span class="op">-</span> <span class="fl">2</span><span class="op">*</span><span class="va">xy</span><span class="op">*</span><span class="va">rho</span> <span class="op">+</span> <span class="va">y2</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">rho</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">l_1</span> <span class="op">&lt;-</span> <span class="va">N</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu">pbivnorm</span><span class="op">(</span><span class="op">-</span><span class="va">Zthres</span>, <span class="op">-</span><span class="va">Zthres</span>, <span class="va">rho</span><span class="op">)</span> <span class="op">+</span></span>
<span>                 <span class="fu">pbivnorm</span><span class="op">(</span><span class="va">Zthres</span>, <span class="va">Zthres</span>, <span class="va">rho</span><span class="op">)</span> <span class="op">+</span></span>
<span>                 <span class="fu">pbivnorm</span><span class="op">(</span><span class="va">Zthres</span>, <span class="op">-</span><span class="va">Zthres</span>, <span class="va">rho</span><span class="op">)</span> <span class="op">+</span></span>
<span>                 <span class="fu">pbivnorm</span><span class="op">(</span><span class="op">-</span><span class="va">Zthres</span>, <span class="va">Zthres</span>, <span class="va">rho</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">l_0</span> <span class="op">-</span> <span class="va">l_1</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">calc_corrR</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">OR1</span>, <span class="va">OR2</span>, <span class="va">SE1</span>, <span class="va">SE2</span>, <span class="va">Zthres</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">bestRho</span> <span class="op">=</span> <span class="fl">0.0</span></span>
<span>  <span class="va">Zs</span> <span class="op">&lt;-</span> <span class="fu">get_z</span><span class="op">(</span><span class="va">OR1</span>, <span class="va">OR2</span>, <span class="va">SE1</span>, <span class="va">SE2</span>, <span class="va">Zthres</span><span class="op">)</span></span>
<span>  <span class="va">maxLogL</span> <span class="op">=</span> <span class="fu">calc_logLikelihood</span><span class="op">(</span>x2 <span class="op">=</span> <span class="va">Zs</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, y2 <span class="op">=</span> <span class="va">Zs</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, xy <span class="op">=</span> <span class="va">Zs</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, rho <span class="op">=</span> <span class="va">bestRho</span>, N <span class="op">=</span> <span class="va">Zs</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>                               Zthres <span class="op">=</span> <span class="va">Zthres</span><span class="op">)</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">rho</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0.001</span>, to <span class="op">=</span> <span class="fl">.999</span>, by <span class="op">=</span> <span class="fl">.001</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">tmpLogL</span> <span class="op">=</span> <span class="fu">calc_logLikelihood</span><span class="op">(</span>x2 <span class="op">=</span> <span class="va">Zs</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, y2 <span class="op">=</span> <span class="va">Zs</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, xy <span class="op">=</span> <span class="va">Zs</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, rho <span class="op">=</span> <span class="va">rho</span>, N <span class="op">=</span> <span class="va">Zs</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>                                 Zthres <span class="op">=</span> <span class="va">Zthres</span><span class="op">)</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">tmpLogL</span> <span class="op">&gt;</span> <span class="va">maxLogL</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">maxLogL</span> <span class="op">=</span> <span class="va">tmpLogL</span></span>
<span>      <span class="va">bestRho</span> <span class="op">=</span> <span class="va">rho</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">bestRho</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># main helper function for CC-GWAS</span></span>
<span><span class="co"># uses the case and control AF for each of the two traits as well as the case and control</span></span>
<span><span class="co"># sample sizes of each trait</span></span>
<span><span class="va">calc_ccgwas</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">trait1_AF_case</span>, <span class="va">trait2_AF_case</span>, <span class="va">trait1_N_case</span>, <span class="va">trait2_N_case</span>,</span>
<span>                        <span class="va">trait1_AF_control</span>, <span class="va">trait2_AF_control</span>, <span class="va">trait1_N_control</span>, <span class="va">trait2_N_control</span>,</span>
<span>                        <span class="va">N_caseInCase</span> <span class="op">=</span> <span class="cn">NA</span>, <span class="va">N_controlInControl</span> <span class="op">=</span> <span class="cn">NA</span>, <span class="va">N_caseInControl</span> <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>                        <span class="va">Zthreshold</span> <span class="op">=</span> <span class="fl">0.0</span>, <span class="va">trait1_OR</span>, <span class="va">trait2_OR</span>, <span class="va">trait1_SE</span>, <span class="va">trait2_SE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># first define the sample overlap matrices</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">N_caseInCase</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">N_caseInCase</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">trait1_N_case</span> <span class="op">+</span> <span class="va">trait2_N_case</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="va">trait1_N_case</span> <span class="op">+</span> <span class="va">trait2_N_case</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">N_controlInControl</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">N_controlInControl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">trait1_N_control</span> <span class="op">+</span> <span class="va">trait2_N_control</span>, <span class="fl">0</span>, <span class="fl">0</span>, </span>
<span>                                          <span class="va">trait1_N_control</span> <span class="op">+</span> <span class="va">trait2_N_control</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">N_caseInControl</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">N_caseInControl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># correct for sample overlap  by calculating correlation</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">Zthreshold</span> <span class="op">&gt;</span> <span class="fl">0.0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">CorrR</span> <span class="op">=</span> <span class="fu">calc_corrR</span><span class="op">(</span>OR1 <span class="op">=</span> <span class="va">trait1_OR</span>, OR2 <span class="op">=</span> <span class="va">trait2_OR</span>, SE1 <span class="op">=</span> <span class="va">trait1_SE</span>,</span>
<span>                       SE2 <span class="op">=</span> <span class="va">trait2_SE</span>, Zthres <span class="op">=</span> <span class="va">Zthreshold</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Est. sample overlap: "</span>, <span class="va">CorrR</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># update sample overlap matrices</span></span>
<span>    <span class="va">N_caseInCase</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">N_caseInCase</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">N_caseInCase</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="va">CorrR</span></span>
<span>    <span class="va">N_caseInCase</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">N_caseInCase</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">N_caseInCase</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="va">CorrR</span></span>
<span>    <span class="va">N_controlInControl</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">N_controlInControl</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">N_controlInControl</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="va">CorrR</span></span>
<span>    <span class="va">N_controlInControl</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">N_controlInControl</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">N_controlInControl</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="va">CorrR</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># now we can calculate the default factor for trait 1 and 2 in cases and controls</span></span>
<span>  <span class="va">DefCase</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">(</span><span class="va">N_caseInCase</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="op">(</span><span class="va">N_caseInCase</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">N_caseInCase</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               <span class="op">(</span><span class="va">N_caseInCase</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span><span class="op">/</span><span class="op">(</span><span class="va">N_caseInCase</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">N_caseInCase</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">DefControl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">(</span><span class="va">N_controlInControl</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="op">(</span><span class="va">N_controlInControl</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">N_controlInControl</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  <span class="op">(</span><span class="va">N_controlInControl</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span><span class="op">/</span><span class="op">(</span><span class="va">N_controlInControl</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">N_controlInControl</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># now we calculate the OR, SE, and p for cases and controls separately</span></span>
<span>  <span class="co"># controls are used for analysis of stratification </span></span>
<span>  <span class="co"># overall final CC-GWAS result OR is exp(log(OR_case) - log(OR_control))</span></span>
<span>  <span class="va">OR_stat_control</span> <span class="op">&lt;-</span> <span class="fu">calc_ORStat</span><span class="op">(</span><span class="va">trait1_AF_control</span>, <span class="va">trait1_N_control</span>, <span class="va">trait2_AF_control</span>, <span class="va">trait2_N_control</span>, <span class="va">DefControl</span><span class="op">)</span></span>
<span>  <span class="va">OR_stat_case</span> <span class="op">&lt;-</span> <span class="fu">calc_ORStat</span><span class="op">(</span><span class="va">trait1_AF_case</span>, <span class="va">trait1_N_case</span>, <span class="va">trait2_AF_case</span>, <span class="va">trait2_N_case</span>, <span class="va">DefCase</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">OR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">OR_stat_case</span><span class="op">$</span><span class="va">OR</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">OR_stat_control</span><span class="op">$</span><span class="va">OR</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">SE</span> <span class="op">&lt;-</span> <span class="va">OR_stat_case</span><span class="op">$</span><span class="va">SE</span></span>
<span>  <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">calc_waldP</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">OR</span><span class="op">)</span>, <span class="va">SE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>OR <span class="op">=</span> <span class="va">OR</span>, SE <span class="op">=</span> <span class="va">SE</span>, p <span class="op">=</span> <span class="va">p</span>,</span>
<span>                    OR_control <span class="op">=</span> <span class="va">OR_stat_control</span><span class="op">$</span><span class="va">OR</span>,</span>
<span>                    SE_control <span class="op">=</span> <span class="va">OR_stat_control</span><span class="op">$</span><span class="va">SE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="co">#' @title CC_GWAS</span></span>
<span><span class="co">#' @description</span></span>
<span><span class="co">#' This is a function to run a case-case GWAS using the framework introduced in the ReACt package. The method will first filter out any SNPs with NA in the case or control AF. It will then remove any SNPs that are not present in both datasets. Finally, it will remove duplicate SNPs, by defualt keeping the first record. Then the CC-GWAS will be run. </span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' @param trait1_data a dataframe containing the chromosome, position, case AF, and control AF for each SNP for trait 1</span></span>
<span><span class="co">#' @param trait2_data a dataframe containing the chromosome, position, case AF, and control AF for each SNP for trait 2</span></span>
<span><span class="co">#' @param trait1_N_case the number of cases in trait 1 dataset</span></span>
<span><span class="co">#' @param trait1_N_control the number of controls in trait 1 dataset</span></span>
<span><span class="co">#' @param trait2_N_case the number of cases in trait 2 dataset</span></span>
<span><span class="co">#' @param trait2_N_control the number of controls in trait 2 dataset</span></span>
<span><span class="co">#' @param AF_case_colname a string with the name for the column containing the case AF in both trait 1 and trait 2 datasets; default: "AF_case"</span></span>
<span><span class="co">#' @param AF_control_colname a string with the name for the column containing the control AF in both trait 1 and trait 2 datasets; default: "AF_control"</span></span>
<span><span class="co">#' @param chromosome_colname a string with the name for the column containing the SNP chromosome number in both trait 1 and trait 2 datasets; default: "chr"</span></span>
<span><span class="co">#' @param position_colname a string with the name for the column containing the SNP position in both trait 1 and trait 2 datasets; default: "pos"</span></span>
<span><span class="co">#' @param id_colname a string containing the id for each SNP in both trait 1 and trait 2 datasets; default: NA. If NA, then an ID column will be added and used for data filtering</span></span>
<span><span class="co">#' @param OR_colname a string with the name for the column with the OR from the GWAS summary statistics for each trait</span></span>
<span><span class="co">#' @param SE_colname a string with the name for the column with the SE from the GWAS summary statistics for each trait</span></span>
<span><span class="co">#' @param N_caseInCase a 2x2 matrix where the upper left cell (a) is the number of cases in study 1 and the lower right cell (d) is the number of cases in study 2. Cells b and c are the number of overlapping cases; Default = NA - if left as NA algorithm will assume no sample overlap</span></span>
<span><span class="co">#' @param N_controlInControl a 2x2 matrix where the upper left cell (a) is the number of controls in study 1 and the lower right cell (d) is the number of controls in study 2. Cells b and c are the number of overlapping controls; Default = NA - if left as NA algorithm will assume no sample overlap</span></span>
<span><span class="co">#' @param N_caseInControl a 2x2 matrix of the number of cases in the control sample. The upper right cell (b) represents the number of cases from trait 1 that are present as controls for trait 2. The lower left cell (c) is the number of cases from trait 2 that are included as controls for trait 1. Cells a and d should be 0; Default = NA - if left as NA algorithm will assume no sample overlap</span></span>
<span><span class="co">#' @param Zthreshold value for the z-statistic threshold. If Zthreshold = 0 then will not perform correction for sample overlap (In order to run correction for sample overlap, OR and SE in each trait's data is required). Yang et al suggest using a threshold of z=1.0; however, this will overlap user input sample sizes. If exact sample sizes and overlap is known, this parameter should be left at 0. </span></span>
<span><span class="co">#' @note</span></span>
<span><span class="co">#'  trait1_data and trait2_data need to have the same column names for chromosome, position, OR, SE, and case and control AFs.</span></span>
<span><span class="co">#' @return returns a dataframe with the original data (where each dataset's original columns with have .trait1 or .trait2 appended to its column name) and three additional columns for the CC-GWAS results: OR, SE, p</span></span>
<span><span class="co">#' equal to the number of variants</span></span>
<span><span class="co">#' @import tidyverse</span></span>
<span><span class="co">#' @import pbivnorm</span></span>
<span><span class="co">#' @export </span></span>
<span><span class="va">CC_GWAS</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">trait1_data</span>, <span class="va">trait2_data</span>, </span>
<span>                    <span class="va">AF_case_colname</span> <span class="op">=</span> <span class="st">"AF_case"</span>, <span class="va">AF_control_colname</span> <span class="op">=</span> <span class="st">"AF_control"</span>,</span>
<span>                    <span class="va">trait1_N_case</span>, <span class="va">trait1_N_control</span>, <span class="va">trait2_N_case</span>, <span class="va">trait2_N_control</span>,</span>
<span>                    <span class="va">chromosome_colname</span> <span class="op">=</span> <span class="st">"chr"</span>, <span class="va">position_colname</span> <span class="op">=</span> <span class="st">"pos"</span>, <span class="va">id_colname</span> <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>                    <span class="va">A1_colname</span> <span class="op">=</span> <span class="st">"A1"</span>, <span class="va">A2_colname</span> <span class="op">=</span> <span class="st">"A2"</span>, <span class="va">rsid_colname</span> <span class="op">=</span> <span class="st">"RSID"</span>, <span class="va">OR_colname</span> <span class="op">=</span> <span class="st">"OR"</span>,</span>
<span>                    <span class="va">SE_colname</span> <span class="op">=</span> <span class="st">"SE"</span>,</span>
<span>                    <span class="va">N_caseInCase</span> <span class="op">=</span> <span class="cn">NA</span>, <span class="va">N_controlInControl</span> <span class="op">=</span> <span class="cn">NA</span>, <span class="va">N_caseInControl</span> <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>                    <span class="va">Zthreshold</span> <span class="op">=</span> <span class="fl">0.0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/brentonk/pbivnorm" class="external-link">pbivnorm</a></span><span class="op">)</span></span>
<span>  <span class="co"># First need to make sure there are no SNPs with NA is the case or control AFs</span></span>
<span>  <span class="va">NA_case_1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">trait1_data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">AF_case_colname</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">NA_case_2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">trait2_data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">AF_case_colname</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">NA_control_1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">trait1_data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">AF_control_colname</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">NA_control_2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">trait2_data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">AF_control_colname</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">NA_rm1</span> <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="va">NA_rm2</span> <span class="op">=</span> <span class="fl">0</span></span>
<span>  </span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">NA_case_1</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">NA_control_1</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">trait1_data_filt</span> <span class="op">&lt;-</span> <span class="va">trait1_data</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">trait1_data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">AF_case_colname</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>                                      <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">trait1_data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">AF_control_colname</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,<span class="op">]</span></span>
<span>    <span class="va">NA_rm1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">trait1_data</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">trait1_data_filt</span><span class="op">)</span></span>
<span>    <span class="va">trait1_data</span> <span class="op">&lt;-</span> <span class="va">trait1_data_filt</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">trait1_data_filt</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">NA_case_2</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">NA_control_2</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">trait2_data_filt</span> <span class="op">&lt;-</span> <span class="va">trait2_data</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">trait2_data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">AF_case_colname</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>                                      <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">trait2_data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">AF_control_colname</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,<span class="op">]</span></span>
<span>    <span class="va">NA_rm2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">trait2_data</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">trait2_data_filt</span><span class="op">)</span></span>
<span>    <span class="va">trait2_data</span> <span class="op">&lt;-</span> <span class="va">trait2_data_filt</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">trait2_data_filt</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">NA_case_1</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">NA_case_2</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">NA_control_1</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">NA_control_2</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># now make sure that both datasets have the same variants</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">id_colname</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">trait1_data</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">trait1_data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">chromosome_colname</span><span class="op">)</span><span class="op">]</span>, <span class="st">":"</span>, </span>
<span>                             <span class="va">trait1_data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">position_colname</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">trait2_data</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">trait2_data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">chromosome_colname</span><span class="op">)</span><span class="op">]</span>, <span class="st">":"</span>, </span>
<span>                             <span class="va">trait2_data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">position_colname</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">trait1_data</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">trait2_data</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">overlap</span> <span class="op">&lt;-</span> <span class="va">trait1_data</span><span class="op">$</span><span class="va">id</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">trait1_data</span><span class="op">$</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">trait2_data</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">]</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">overlap</span> <span class="op">&lt;-</span> <span class="va">trait2_data</span><span class="op">$</span><span class="va">id</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">trait2_data</span><span class="op">$</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">trait1_data</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">]</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="va">id_colname</span> <span class="op">=</span> <span class="st">"id"</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">trait1_data</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">trait1_data</span><span class="op">)</span> <span class="op">==</span> <span class="va">id_colname</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"id"</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">trait2_data</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">trait2_data</span><span class="op">)</span> <span class="op">==</span> <span class="va">id_colname</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"id"</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">trait1_data</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">trait2_data</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">overlap</span> <span class="op">&lt;-</span> <span class="va">trait1_data</span><span class="op">$</span><span class="va">id</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">trait1_data</span><span class="op">$</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">trait2_data</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">]</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">overlap</span> <span class="op">&lt;-</span> <span class="va">trait2_data</span><span class="op">$</span><span class="va">id</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">trait2_data</span><span class="op">$</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">trait1_data</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">]</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">overlap_rm1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">trait1_data</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">overlap</span><span class="op">)</span></span>
<span>  <span class="va">overlap_rm2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">trait2_data</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">overlap</span><span class="op">)</span></span>
<span>  <span class="va">trait1_data</span> <span class="op">&lt;-</span> <span class="va">trait1_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">overlap</span><span class="op">)</span></span>
<span>  <span class="va">trait2_data</span> <span class="op">&lt;-</span> <span class="va">trait2_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">overlap</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># now keep only distinct </span></span>
<span>  <span class="va">trait1_data_filt</span> <span class="op">&lt;-</span> <span class="va">trait1_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">id</span>, .keep_all <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span>  <span class="va">trait2_data_filt</span> <span class="op">&lt;-</span> <span class="va">trait2_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">id</span>, .keep_all <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span>  <span class="va">distinct_rm1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">trait1_data</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">trait1_data_filt</span><span class="op">)</span></span>
<span>  <span class="va">distinct_rm2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">trait2_data</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">trait2_data_filt</span><span class="op">)</span></span>
<span>  <span class="va">trait1_data</span> <span class="op">=</span> <span class="va">trait1_data_filt</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">trait1_data_filt</span><span class="op">)</span></span>
<span>  <span class="va">trait2_data</span> <span class="op">=</span> <span class="va">trait2_data_filt</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">trait2_data_filt</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">nRemoved</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                         NA_removed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">NA_rm1</span>, <span class="va">NA_rm1</span><span class="op">)</span>,</span>
<span>                         overlap_removed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">overlap_rm1</span>, <span class="va">overlap_rm2</span><span class="op">)</span>,</span>
<span>                         distinct_removed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">distinct_rm1</span>, <span class="va">distinct_rm2</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="op">(</span><span class="st">"Removed the following number of variants due to NAs in AFs, SNPs not in both datasets, or duplicate SNPs:"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">nRemoved</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># rename columns so I can use dplyr to select desired ones for output</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">trait1_data</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">trait1_data</span><span class="op">)</span> <span class="op">==</span> <span class="va">chromosome_colname</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"chr"</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">trait1_data</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">trait1_data</span><span class="op">)</span> <span class="op">==</span> <span class="va">position_colname</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"pos"</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">trait1_data</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">trait1_data</span><span class="op">)</span> <span class="op">==</span> <span class="va">rsid_colname</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"RSID"</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">trait2_data</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">trait2_data</span><span class="op">)</span> <span class="op">==</span> <span class="va">chromosome_colname</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"chr"</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">trait2_data</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">trait2_data</span><span class="op">)</span> <span class="op">==</span> <span class="va">position_colname</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"pos"</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">trait2_data</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">trait2_data</span><span class="op">)</span> <span class="op">==</span> <span class="va">rsid_colname</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"RSID"</span></span>
<span>  </span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">AF_case_colname</span> <span class="op">!=</span> <span class="st">"AF_case"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">trait1_data</span><span class="op">$</span><span class="va">AF_case</span> <span class="op">&lt;-</span> <span class="va">trait1_data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">AF_case_colname</span><span class="op">)</span><span class="op">]</span></span>
<span>    <span class="va">trait2_data</span><span class="op">$</span><span class="va">AF_case</span> <span class="op">&lt;-</span> <span class="va">trait2_data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">AF_case_colname</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">AF_control_colname</span> <span class="op">!=</span> <span class="st">"AF_control"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">trait1_data</span><span class="op">$</span><span class="va">AF_control</span> <span class="op">&lt;-</span> <span class="va">trait1_data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">AF_control_colname</span><span class="op">)</span><span class="op">]</span></span>
<span>    <span class="va">trait2_data</span><span class="op">$</span><span class="va">AF_control</span> <span class="op">&lt;-</span> <span class="va">trait2_data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">AF_control_colname</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">A1_colname</span> <span class="op">!=</span> <span class="st">"A1"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">trait1_data</span><span class="op">$</span><span class="va">A1</span> <span class="op">&lt;-</span> <span class="va">trait1_data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">A1_colname</span><span class="op">)</span><span class="op">]</span></span>
<span>    <span class="va">trait2_data</span><span class="op">$</span><span class="va">A1</span> <span class="op">&lt;-</span> <span class="va">trait2_data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">A1_colname</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">A2_colname</span> <span class="op">!=</span> <span class="st">"A2"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">trait1_data</span><span class="op">$</span><span class="va">A2</span> <span class="op">&lt;-</span> <span class="va">trait1_data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">A2_colname</span><span class="op">)</span><span class="op">]</span></span>
<span>    <span class="va">trait2_data</span><span class="op">$</span><span class="va">A2</span> <span class="op">&lt;-</span> <span class="va">trait2_data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">A2_colname</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">OR_colname</span> <span class="op">!=</span> <span class="st">"OR"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">trait1_data</span><span class="op">$</span><span class="va">OR</span> <span class="op">&lt;-</span> <span class="va">trait1_data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">OR_colname</span><span class="op">)</span><span class="op">]</span></span>
<span>    <span class="va">trait2_data</span><span class="op">$</span><span class="va">OR</span> <span class="op">&lt;-</span> <span class="va">trait2_data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">OR_colname</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">SE_colname</span> <span class="op">!=</span> <span class="st">"SE"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">trait1_data</span><span class="op">$</span><span class="va">SE</span> <span class="op">&lt;-</span> <span class="va">trait1_data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">SE_colname</span><span class="op">)</span><span class="op">]</span></span>
<span>    <span class="va">trait2_data</span><span class="op">$</span><span class="va">SE</span> <span class="op">&lt;-</span> <span class="va">trait2_data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">SE_colname</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># make sure trait1 and trait2 are in the same order </span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">trait1_data</span><span class="op">)</span> <span class="op">!=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">trait2_data</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Number of SNPs doesn't match"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">combined</span> <span class="op">&lt;-</span> <span class="va">trait1_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">trait2_data</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span> <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span>,</span>
<span>                                         suffix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">".trait1"</span>, <span class="st">".trait2"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># make sure alleles match (if they don't switch allele in trait 2 to match trait 1)</span></span>
<span>  <span class="va">combined</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">combined</span><span class="op">$</span><span class="va">A1.trait1</span> <span class="op">!=</span> <span class="va">combined</span><span class="op">$</span><span class="va">A1.trait2</span><span class="op">)</span>, <span class="op">]</span><span class="op">$</span><span class="va">AF_case.trait2</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">-</span><span class="va">combined</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">combined</span><span class="op">$</span><span class="va">A1.trait1</span> <span class="op">!=</span> <span class="va">combined</span><span class="op">$</span><span class="va">A1.trait2</span><span class="op">)</span>, <span class="op">]</span><span class="op">$</span><span class="va">AF_case.trait2</span></span>
<span>  <span class="va">combined</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">combined</span><span class="op">$</span><span class="va">A1.trait1</span> <span class="op">!=</span> <span class="va">combined</span><span class="op">$</span><span class="va">A1.trait2</span><span class="op">)</span>, <span class="op">]</span><span class="op">$</span><span class="va">AF_control.trait2</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">-</span><span class="va">combined</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">combined</span><span class="op">$</span><span class="va">A1.trait1</span> <span class="op">!=</span> <span class="va">combined</span><span class="op">$</span><span class="va">A1.trait2</span><span class="op">)</span>, <span class="op">]</span><span class="op">$</span><span class="va">AF_control.trait2</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/gc.html" class="external-link">gc</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">combined</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">combined</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># run the actual CC-GWAS using the cleaned datasets</span></span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">calc_ccgwas</span><span class="op">(</span>trait1_AF_case <span class="op">=</span> <span class="va">combined</span><span class="op">[</span>,<span class="st">"AF_case.trait1"</span><span class="op">]</span>,</span>
<span>                         trait2_AF_case <span class="op">=</span> <span class="va">combined</span><span class="op">[</span>,<span class="st">"AF_case.trait2"</span><span class="op">]</span>,</span>
<span>                         trait1_AF_control <span class="op">=</span> <span class="va">combined</span><span class="op">[</span>,<span class="st">"AF_control.trait1"</span><span class="op">]</span>,</span>
<span>                         trait2_AF_control <span class="op">=</span> <span class="va">combined</span><span class="op">[</span>,<span class="st">"AF_control.trait2"</span><span class="op">]</span>,</span>
<span>                         trait1_N_case <span class="op">=</span> <span class="va">trait1_N_case</span>,</span>
<span>                         trait2_N_case <span class="op">=</span> <span class="va">trait2_N_case</span>,</span>
<span>                         trait1_N_control <span class="op">=</span> <span class="va">trait1_N_control</span>,</span>
<span>                         trait2_N_control <span class="op">=</span> <span class="va">trait2_N_control</span>,</span>
<span>                         trait1_OR <span class="op">=</span> <span class="va">combined</span><span class="op">[</span>,<span class="st">"OR.trait1"</span><span class="op">]</span>,</span>
<span>                         trait2_OR <span class="op">=</span> <span class="va">combined</span><span class="op">[</span>,<span class="st">"OR.trait2"</span><span class="op">]</span>,</span>
<span>                         trait1_SE <span class="op">=</span> <span class="va">combined</span><span class="op">[</span>,<span class="st">"SE.trait1"</span><span class="op">]</span>,</span>
<span>                         trait2_SE <span class="op">=</span> <span class="va">combined</span><span class="op">[</span>,<span class="st">"SE.trait2"</span><span class="op">]</span>,</span>
<span>                         Zthreshold <span class="op">=</span> <span class="va">Zthreshold</span>,</span>
<span>                         N_controlInControl <span class="op">=</span> <span class="va">N_controlInControl</span>,</span>
<span>                         N_caseInCase <span class="op">=</span> <span class="va">N_caseInCase</span>,</span>
<span>                         N_caseInControl <span class="op">=</span> <span class="va">N_caseInControl</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">meta_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"chr.trait1"</span>, <span class="st">"pos.trait1"</span>, <span class="st">"RSID.trait1"</span>, <span class="st">"A1.trait1"</span>, <span class="st">"A2.trait1"</span>,</span>
<span>                 <span class="st">"AF_case.trait1"</span>, <span class="st">"AF_case.trait2"</span>, <span class="st">"AF_control.trait1"</span>,</span>
<span>                 <span class="st">"AF_control.trait2"</span><span class="op">)</span></span>
<span>  <span class="va">toreturn</span> <span class="op">&lt;-</span> <span class="va">combined</span><span class="op">[</span>,<span class="va">meta_cols</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">toreturn</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"chr"</span>, <span class="st">"pos"</span>, <span class="st">"RSID"</span>, <span class="st">"A1"</span>, <span class="st">"A2"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">toreturn</span> <span class="op">&lt;-</span> <span class="va">toreturn</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">toreturn</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># plotting code</span></span>
<span><span class="va">CC_GWAS_plot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">results</span>, <span class="va">chromosome_colname</span> <span class="op">=</span> <span class="st">"chr"</span>, <span class="va">position_colname</span> <span class="op">=</span> <span class="st">"pos"</span>,</span>
<span>                         <span class="va">title</span> <span class="op">=</span> <span class="st">"CC-GWAS"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># first make sure the columns have the same names (chr, pos) so I can use tidyverse</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">==</span> <span class="va">chromosome_colname</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"chr"</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">==</span> <span class="va">position_colname</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"pos"</span></span>
<span>  </span>
<span>  <span class="va">results</span><span class="op">$</span><span class="va">chr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">chr</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># First need to claculate the cumulatative position of the SNP</span></span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span> <span class="va">results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">chr</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>chr_length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">pos</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    </span>
<span>    <span class="co"># calculate the cumulative position of each chromosome</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>tot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">chr_length</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="va">chr_length</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">chr_length</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    </span>
<span>    <span class="co"># add this info to the initial dataset</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">results</span>, <span class="va">.</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"chr"</span> <span class="op">=</span> <span class="st">"chr"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    </span>
<span>    <span class="co"># add cumulative position of each SNP</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">chr</span>, <span class="va">pos</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pos_cum <span class="op">=</span> <span class="va">pos</span> <span class="op">+</span> <span class="va">tot</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># need to prepare x-axis so we can show the chromosome number not the SNP position</span></span>
<span>  <span class="va">axisdf</span> <span class="op">=</span> <span class="va">results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">chr</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>center <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">pos_cum</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">pos_cum</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">results</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pos_cum</span>, y <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">chr</span><span class="op">)</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, size <span class="op">=</span> <span class="fl">1.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"grey40"</span>, <span class="st">"black"</span><span class="op">)</span>, <span class="fl">22</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">axisdf</span><span class="op">$</span><span class="va">chr</span>, breaks <span class="op">=</span> <span class="va">axisdf</span><span class="op">$</span><span class="va">center</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="fl">0.05</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Chromosome"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"-log10(p-value)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="va">title</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>      legend.position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>      panel.border <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      panel.grid.major.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      panel.grid.minor.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="cc-gwas-analysis">CC-GWAS Analysis<a class="anchor" aria-label="anchor" href="#cc-gwas-analysis"></a>
</h2>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="st">"C:/Users/HayBa/Documents/Graduate School/GeneticPredisposition/CC-GWAS/"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org" class="external-link">scales</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://andrisignorell.github.io/DescTools/" class="external-link">DescTools</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/wolffha/CaseControlAF/" class="external-link">CaseControlAF</a></span><span class="op">)</span></span></code></pre></div>
<p>Load in data and format as needed</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.delim</a></span><span class="op">(</span><span class="st">"/home/wolffha/CC-GWAS/AoU/295.1/pheno_295.1_EUR.tsv.gz"</span><span class="op">)</span></span>
<span><span class="va">bp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.delim</a></span><span class="op">(</span><span class="st">"/home/wolffha/CC-GWAS/AoU/296.1/pheno_296.1_EUR.tsv.gz"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nCase_sz</span> <span class="op">&lt;-</span> <span class="fl">584</span></span>
<span><span class="va">nControl_sz</span> <span class="op">&lt;-</span> <span class="fl">98402</span></span>
<span><span class="va">nCase_bp</span> <span class="op">&lt;-</span> <span class="fl">2865</span></span>
<span><span class="va">nControl_bp</span> <span class="op">&lt;-</span> <span class="fl">92758</span></span>
<span></span>
<span><span class="va">nTot_sz</span> <span class="op">&lt;-</span> <span class="va">nCase_sz</span> <span class="op">+</span> <span class="va">nControl_sz</span></span>
<span><span class="va">nTot_bp</span> <span class="op">&lt;-</span> <span class="va">nCase_bp</span> <span class="op">+</span> <span class="va">nControl_bp</span></span>
<span></span>
<span><span class="co"># colnames:</span></span>
<span><span class="co"># locus | alleles | phenoname | variant+id | n_cases | n_controls | BETA</span></span>
<span><span class="co"># SE | AF_case | AF_ctrl | AF_Allele2 | AC_Allele2</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">sz</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"locus"</span>, <span class="st">"alleles"</span>, <span class="st">"phenoname"</span>, <span class="st">"variant_id"</span>, <span class="st">"n_cases"</span>, <span class="st">"n_controls"</span>,</span>
<span>                  <span class="st">"BETA"</span>, <span class="st">"SE"</span>, <span class="st">"true_AF_case"</span>, <span class="st">"true_AF_control"</span>, <span class="st">"AF_Allele2"</span>, <span class="st">"AC_Allele2"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">bp</span><span class="op">)</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"locus"</span>, <span class="st">"alleles"</span>, <span class="st">"phenoname"</span>, <span class="st">"variant_id"</span>, <span class="st">"n_cases"</span>, <span class="st">"n_controls"</span>,</span>
<span>                   <span class="st">"BETA"</span>, <span class="st">"SE"</span>, <span class="st">"true_AF_case"</span>, <span class="st">"true_AF_control"</span>, <span class="st">"AF_Allele2"</span>, <span class="st">"AC_Allele2"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># remove any variants with NAs </span></span>
<span><span class="va">sz</span> <span class="op">&lt;-</span> <span class="va">sz</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">sz</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">bp</span> <span class="op">&lt;-</span> <span class="va">bp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">bp</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co"># remove variants with Case and Control MAC &lt; 40 - per AoU requirements</span></span>
<span><span class="co"># calculate MAF</span></span>
<span><span class="va">sz</span><span class="op">$</span><span class="va">maf_case</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">sz</span><span class="op">$</span><span class="va">true_AF_case</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">.5</span>, <span class="fl">1</span><span class="op">-</span><span class="va">x</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sz</span><span class="op">$</span><span class="va">maf_control</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">sz</span><span class="op">$</span><span class="va">true_AF_control</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">.5</span>, <span class="fl">1</span><span class="op">-</span><span class="va">x</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bp</span><span class="op">$</span><span class="va">maf_case</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">bp</span><span class="op">$</span><span class="va">true_AF_case</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">.5</span>, <span class="fl">1</span><span class="op">-</span><span class="va">x</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bp</span><span class="op">$</span><span class="va">maf_control</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">bp</span><span class="op">$</span><span class="va">true_AF_control</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">.5</span>, <span class="fl">1</span><span class="op">-</span><span class="va">x</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate AC columns</span></span>
<span><span class="va">sz</span><span class="op">$</span><span class="va">MAC_case</span> <span class="op">&lt;-</span> <span class="va">sz</span><span class="op">$</span><span class="va">maf_case</span><span class="op">*</span><span class="va">nCase_sz</span><span class="op">*</span><span class="fl">2</span></span>
<span><span class="va">sz</span><span class="op">$</span><span class="va">MAC_control</span> <span class="op">&lt;-</span> <span class="va">sz</span><span class="op">$</span><span class="va">maf_control</span><span class="op">*</span><span class="va">nControl_sz</span><span class="op">*</span><span class="fl">2</span></span>
<span><span class="va">bp</span><span class="op">$</span><span class="va">MAC_case</span> <span class="op">&lt;-</span> <span class="va">bp</span><span class="op">$</span><span class="va">maf_case</span><span class="op">*</span><span class="va">nCase_bp</span><span class="op">*</span><span class="fl">2</span></span>
<span><span class="va">bp</span><span class="op">$</span><span class="va">MAC_control</span> <span class="op">&lt;-</span> <span class="va">bp</span><span class="op">$</span><span class="va">maf_control</span><span class="op">*</span><span class="va">nControl_bp</span><span class="op">*</span><span class="fl">2</span></span>
<span></span>
<span><span class="va">sz</span> <span class="op">&lt;-</span> <span class="va">sz</span><span class="op">[</span><span class="va">sz</span><span class="op">$</span><span class="va">MAC_case</span> <span class="op">&gt;</span> <span class="fl">40</span> <span class="op">&amp;</span> <span class="va">sz</span><span class="op">$</span><span class="va">MAC_control</span> <span class="op">&gt;</span> <span class="fl">40</span>, <span class="op">]</span></span>
<span><span class="va">bp</span> <span class="op">&lt;-</span> <span class="va">bp</span><span class="op">[</span><span class="va">bp</span><span class="op">$</span><span class="va">MAC_case</span> <span class="op">&gt;</span> <span class="fl">40</span> <span class="op">&amp;</span> <span class="va">bp</span><span class="op">$</span><span class="va">MAC_control</span> <span class="op">&gt;</span> <span class="fl">40</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># setup the dataframes as needed:</span></span>
<span><span class="co"># need chromosome and position columns from locus</span></span>
<span><span class="va">sz</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="va">sz</span><span class="op">$</span><span class="va">locus</span></span>
<span><span class="va">sz</span> <span class="op">&lt;-</span> <span class="va">sz</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html" class="external-link">separate</a></span><span class="op">(</span><span class="va">locus</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"chr"</span>, <span class="st">"pos"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">":"</span><span class="op">)</span></span>
<span><span class="va">sz</span><span class="op">$</span><span class="va">chr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"chr"</span>, <span class="st">""</span>, <span class="va">sz</span><span class="op">$</span><span class="va">chr</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bp</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="va">bp</span><span class="op">$</span><span class="va">locus</span></span>
<span><span class="va">bp</span> <span class="op">&lt;-</span> <span class="va">bp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html" class="external-link">separate</a></span><span class="op">(</span><span class="va">locus</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"chr"</span>, <span class="st">"pos"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">":"</span><span class="op">)</span></span>
<span><span class="va">bp</span><span class="op">$</span><span class="va">chr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"chr"</span>, <span class="st">""</span>, <span class="va">bp</span><span class="op">$</span><span class="va">chr</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sz</span><span class="op">[</span><span class="va">sz</span><span class="op">$</span><span class="va">chr</span> <span class="op">==</span> <span class="st">"X"</span>, <span class="op">]</span><span class="op">$</span><span class="va">chr</span> <span class="op">&lt;-</span> <span class="fl">23</span></span>
<span><span class="va">sz</span><span class="op">[</span><span class="va">sz</span><span class="op">$</span><span class="va">chr</span> <span class="op">==</span> <span class="st">"Y"</span>, <span class="op">]</span><span class="op">$</span><span class="va">chr</span> <span class="op">&lt;-</span> <span class="fl">24</span></span>
<span><span class="va">bp</span><span class="op">[</span><span class="va">bp</span><span class="op">$</span><span class="va">chr</span> <span class="op">==</span> <span class="st">"X"</span>, <span class="op">]</span><span class="op">$</span><span class="va">chr</span> <span class="op">&lt;-</span> <span class="fl">23</span></span>
<span><span class="va">bp</span><span class="op">[</span><span class="va">bp</span><span class="op">$</span><span class="va">chr</span> <span class="op">==</span> <span class="st">"Y"</span>, <span class="op">]</span><span class="op">$</span><span class="va">chr</span> <span class="op">&lt;-</span> <span class="fl">24</span></span>
<span></span>
<span><span class="va">bp</span><span class="op">$</span><span class="va">chr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">bp</span><span class="op">$</span><span class="va">chr</span><span class="op">)</span></span>
<span><span class="va">bp</span><span class="op">$</span><span class="va">pos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">bp</span><span class="op">$</span><span class="va">pos</span><span class="op">)</span></span>
<span><span class="va">sz</span><span class="op">$</span><span class="va">chr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">sz</span><span class="op">$</span><span class="va">chr</span><span class="op">)</span></span>
<span><span class="va">sz</span><span class="op">$</span><span class="va">pos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">sz</span><span class="op">$</span><span class="va">pos</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># now need allele1 and allele2</span></span>
<span><span class="va">sz</span> <span class="op">&lt;-</span> <span class="va">sz</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>alleles <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">alleles</span>, <span class="st">"\\[(.*?)\\]"</span><span class="op">)</span>,</span>
<span>         alleles <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove_all</a></span><span class="op">(</span><span class="va">alleles</span>, <span class="st">"[\\[\\]\"\\s]"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html" class="external-link">separate</a></span><span class="op">(</span><span class="va">alleles</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A1"</span>, <span class="st">"A2"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">","</span><span class="op">)</span></span>
<span><span class="va">bp</span> <span class="op">&lt;-</span> <span class="va">bp</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>alleles <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">alleles</span>, <span class="st">"\\[(.*?)\\]"</span><span class="op">)</span>,</span>
<span>         alleles <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove_all</a></span><span class="op">(</span><span class="va">alleles</span>, <span class="st">"[\\[\\]\"\\s]"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html" class="external-link">separate</a></span><span class="op">(</span><span class="va">alleles</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A1"</span>, <span class="st">"A2"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">","</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sz</span><span class="op">$</span><span class="va">RSID</span> <span class="op">&lt;-</span> <span class="va">sz</span><span class="op">$</span><span class="va">variant_id</span></span>
<span><span class="va">bp</span><span class="op">$</span><span class="va">RSID</span> <span class="op">&lt;-</span> <span class="va">bp</span><span class="op">$</span><span class="va">variant_id</span></span>
<span></span>
<span><span class="va">sz</span><span class="op">$</span><span class="va">OR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">sz</span><span class="op">$</span><span class="va">BETA</span><span class="op">)</span></span>
<span><span class="va">bp</span><span class="op">$</span><span class="va">OR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">bp</span><span class="op">$</span><span class="va">BETA</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">sz</span><span class="op">)</span></span>
<span><span class="va">bp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">bp</span><span class="op">)</span></span></code></pre></div>
<p>Estimate the case and control AFs using CaseControl_SE and
CaseControl_AF</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get case and control AF using SE</span></span>
<span><span class="va">sz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">sz</span>, <span class="fu"><a href="../reference/CaseControl_SE.html">CaseControl_SE</a></span><span class="op">(</span>N_case <span class="op">=</span> <span class="va">nCase_sz</span>,</span>
<span>                        N_control <span class="op">=</span> <span class="va">nControl_sz</span>,</span>
<span>                        OR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">sz</span><span class="op">$</span><span class="va">BETA</span><span class="op">)</span>,</span>
<span>                        SE <span class="op">=</span> <span class="va">sz</span><span class="op">$</span><span class="va">SE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">bp</span>, <span class="fu"><a href="../reference/CaseControl_SE.html">CaseControl_SE</a></span><span class="op">(</span>N_case <span class="op">=</span> <span class="va">nCase_bp</span>,</span>
<span>                        N_control <span class="op">=</span> <span class="va">nControl_bp</span>,</span>
<span>                        OR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">bp</span><span class="op">$</span><span class="va">BETA</span><span class="op">)</span>,</span>
<span>                        SE <span class="op">=</span> <span class="va">bp</span><span class="op">$</span><span class="va">SE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">sz</span><span class="op">)</span></span>
<span><span class="va">bp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">bp</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get case and control AF using AF</span></span>
<span><span class="va">sz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">sz</span>, <span class="fu"><a href="../reference/CaseControl_AF.html">CaseControl_AF</a></span><span class="op">(</span>N_case <span class="op">=</span> <span class="va">nCase_sz</span>,</span>
<span>                        N_control <span class="op">=</span> <span class="va">nControl_sz</span>,</span>
<span>                        OR <span class="op">=</span> <span class="va">sz</span><span class="op">$</span><span class="va">OR</span>,</span>
<span>                        AF_population <span class="op">=</span> <span class="va">sz</span><span class="op">$</span><span class="va">AF_Allele2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">bp</span>, <span class="fu"><a href="../reference/CaseControl_AF.html">CaseControl_AF</a></span><span class="op">(</span>N_case <span class="op">=</span> <span class="va">nCase_bp</span>,</span>
<span>                        N_control <span class="op">=</span> <span class="va">nControl_bp</span>,</span>
<span>                        OR <span class="op">=</span> <span class="va">bp</span><span class="op">$</span><span class="va">OR</span>,</span>
<span>                        AF_population <span class="op">=</span> <span class="va">bp</span><span class="op">$</span><span class="va">AF_Allele2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">sz</span><span class="op">)</span></span>
<span><span class="va">bp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">bp</span><span class="op">)</span></span></code></pre></div>
<p>Let’s examine the estimated AFs compared to the true AFs</p>
<div class="section level4">
<h4 id="casecontrol_af-estimates">CaseControl_AF estimates<a class="anchor" aria-label="anchor" href="#casecontrol_af-estimates"></a>
</h4>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sz</span><span class="op">$</span><span class="va">maf</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">sz</span><span class="op">$</span><span class="va">maf_case</span><span class="op">*</span><span class="va">nCase_sz</span> <span class="op">+</span> <span class="va">sz</span><span class="op">$</span><span class="va">maf_control</span><span class="op">*</span><span class="va">nControl_sz</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">nCase_sz</span> <span class="op">+</span> <span class="va">nControl_sz</span><span class="op">)</span></span>
<span><span class="va">bp</span><span class="op">$</span><span class="va">maf</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">bp</span><span class="op">$</span><span class="va">maf_case</span><span class="op">*</span><span class="va">nCase_bp</span> <span class="op">+</span> <span class="va">bp</span><span class="op">$</span><span class="va">maf_control</span><span class="op">*</span><span class="va">nControl_bp</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">nCase_bp</span> <span class="op">+</span> <span class="va">nControl_bp</span><span class="op">)</span></span>
<span></span>
<span><span class="va">breaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="fl">0.5</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">sz</span><span class="op">$</span><span class="va">bin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">sz</span><span class="op">$</span><span class="va">maf</span>, breaks <span class="op">=</span> <span class="va">breaks</span>, include.lowest <span class="op">=</span> <span class="cn">T</span>, right <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">bp</span><span class="op">$</span><span class="va">bin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">bp</span><span class="op">$</span><span class="va">maf</span>, breaks <span class="op">=</span> <span class="va">breaks</span>, include.lowest <span class="op">=</span> <span class="cn">T</span>, right <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">AFdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>trueMAF <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sz</span><span class="op">$</span><span class="va">true_AF_case</span>, <span class="va">sz</span><span class="op">$</span><span class="va">true_AF_control</span>, <span class="va">bp</span><span class="op">$</span><span class="va">true_AF_case</span>, </span>
<span>                                 <span class="va">bp</span><span class="op">$</span><span class="va">true_AF_control</span><span class="op">)</span>,</span>
<span>                     estMAF <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sz</span><span class="op">$</span><span class="va">AF_case</span>, <span class="va">sz</span><span class="op">$</span><span class="va">AF_control</span>, <span class="va">bp</span><span class="op">$</span><span class="va">AF_case</span>, <span class="va">bp</span><span class="op">$</span><span class="va">AF_control</span><span class="op">)</span>,</span>
<span>                     bin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sz</span><span class="op">$</span><span class="va">bin</span>, <span class="va">sz</span><span class="op">$</span><span class="va">bin</span>, <span class="va">bp</span><span class="op">$</span><span class="va">bin</span>, <span class="va">bp</span><span class="op">$</span><span class="va">bin</span><span class="op">)</span>,</span>
<span>                     trait <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"SZ"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sz</span><span class="op">)</span><span class="op">*</span><span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"BP"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bp</span><span class="op">)</span><span class="op">*</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     status <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Case"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sz</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Control"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sz</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Case"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bp</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Control"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p_AF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">AFdata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bin</span>, y <span class="op">=</span> <span class="op">(</span><span class="va">estMAF</span><span class="op">-</span><span class="va">trueMAF</span><span class="op">)</span>, fill <span class="op">=</span> <span class="va">trait</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#495CA0"</span>, <span class="st">"goldenrod"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">status</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"CaseControl_AF Estimates"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.075</span>, <span class="fl">0.075</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Estimated - True"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span>plot <span class="op">=</span> <span class="va">p_AF</span>, filename <span class="op">=</span> <span class="st">"szbp_CaseControl_AF_boxplot.png"</span>, width <span class="op">=</span> <span class="fl">14</span>, height <span class="op">=</span> <span class="fl">8</span>, </span>
<span>       units <span class="op">=</span> <span class="st">"in"</span><span class="op">)</span></span></code></pre></div>
<p><img src="szbp_CaseControl_AF_boxplot.png"><strong>Figure
1</strong>. The bias (Estimated MAF - True MAF) for the variants by MAF
bin (x-axis) for each data set estimated using CaseControl_AF. We see
that overall the estimates are very accurate (i.e. the bias is close to
0). For the cases, which have much smaller sample size, there is more
variability in the estimates.</p>
</div>
<div class="section level4">
<h4 id="casecontrol_se-estimates">CaseControl_SE estimates<a class="anchor" aria-label="anchor" href="#casecontrol_se-estimates"></a>
</h4>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SEdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>trueMAF <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sz</span><span class="op">$</span><span class="va">maf_case</span>, <span class="va">sz</span><span class="op">$</span><span class="va">maf_control</span>, <span class="va">bp</span><span class="op">$</span><span class="va">maf_case</span>, <span class="va">bp</span><span class="op">$</span><span class="va">maf_control</span><span class="op">)</span>,</span>
<span>                     estMAF <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sz</span><span class="op">$</span><span class="va">MAF_case</span>, <span class="va">sz</span><span class="op">$</span><span class="va">MAF_control</span>, <span class="va">bp</span><span class="op">$</span><span class="va">MAF_case</span>, <span class="va">bp</span><span class="op">$</span><span class="va">MAF_control</span><span class="op">)</span>,</span>
<span>                     bin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sz</span><span class="op">$</span><span class="va">bin</span>, <span class="va">sz</span><span class="op">$</span><span class="va">bin</span>, <span class="va">bp</span><span class="op">$</span><span class="va">bin</span>, <span class="va">bp</span><span class="op">$</span><span class="va">bin</span><span class="op">)</span>,</span>
<span>                     trait <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"SZ"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sz</span><span class="op">)</span><span class="op">*</span><span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"BP"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bp</span><span class="op">)</span><span class="op">*</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     status <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Case"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sz</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Control"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sz</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Case"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bp</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Control"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p_SE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">SEdata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bin</span>, y <span class="op">=</span> <span class="op">(</span><span class="va">estMAF</span><span class="op">-</span><span class="va">trueMAF</span><span class="op">)</span>, fill <span class="op">=</span> <span class="va">trait</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#495CA0"</span>, <span class="st">"goldenrod"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">status</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"CaseControl_SE Estimates"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.075</span>, <span class="fl">0.075</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Estimated - True"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span>plot <span class="op">=</span> <span class="va">p_SE</span>, filename <span class="op">=</span> <span class="st">"szbp_CaseControl_SE_boxplot.png"</span>, width <span class="op">=</span> <span class="fl">14</span>, height <span class="op">=</span> <span class="fl">8</span>, </span>
<span>       units <span class="op">=</span> <span class="st">"in"</span><span class="op">)</span></span></code></pre></div>
<p><img src="szbp_CaseControl_SE_boxplot.png"><strong>Figure
2</strong>. The bias (Estimated MAF - True MAF) for the variants by MAF
bin (x-axis) for each data set estimated using CaseControl_SE. We see
that the estimated MAF has increasing bias for the larger MAF bins. This
is true of both SZ and BP.</p>
<p>We see that overall results are consistent with those seen in Chapter
III simulations and real data. The CaseControl_AF results are quite
accurate (Figure 1), the CaseControl_SE results are biased at higher
MAFs (Figure 2).We also see the same trend where larger case sample
sizes have overall smaller SEs, which results in increased bias, which
is why the Bipolar
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mrow><mi>c</mi><mi>a</mi><mi>s</mi><mi>e</mi></mrow></msub><mo>=</mo><mn>2856</mn></mrow><annotation encoding="application/x-tex">N_{case} = 2856</annotation></semantics></math>)
CaseControl_SE estimates are more biased than the Schizophrenia
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mrow><mi>c</mi><mi>a</mi><mi>s</mi><mi>e</mi></mrow></msub><mo>=</mo><mn>584</mn></mrow><annotation encoding="application/x-tex">N_{case} = 584</annotation></semantics></math>)
CaseControl_SE estimates.</p>
<p>Define sample overlap matrices</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># a is N is study 1, d is N in study 2, b = c = number overlapping cases</span></span>
<span><span class="va">case_in_case</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">nCase_sz</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="va">nCase_bp</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># a in N control in study 1, d is number of controls in study 2, b = c = overlapping controls</span></span>
<span><span class="va">control_in_control</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">nControl_sz</span>, <span class="va">nControl_bp</span>, <span class="va">nControl_bp</span>, <span class="va">nControl_bp</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># a = d = 0; b is number cases in trait 1 that are controls for trait 2; c is number of cases from trait 2 that are controls as trait 1</span></span>
<span><span class="va">case_in_control</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>Run CC-GWAS using different case and control AFs:</p>
<ol style="list-style-type: decimal">
<li>true known case and control AFs</li>
<li>CaseControl_AF estimated case and control AFs</li>
<li>CaseControl_SE estimated case and control AFs</li>
</ol>
</div>
<div class="section level4">
<h4 id="using-known-afs">Using known AFs<a class="anchor" aria-label="anchor" href="#using-known-afs"></a>
</h4>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_true_af</span> <span class="op">&lt;-</span> <span class="fu">CC_GWAS</span><span class="op">(</span>trait1_data <span class="op">=</span> <span class="va">sz</span>,</span>
<span>                       trait2_data <span class="op">=</span> <span class="va">bp</span>,</span>
<span>                       trait1_N_case <span class="op">=</span> <span class="va">nCase_sz</span>,</span>
<span>                       trait2_N_case <span class="op">=</span> <span class="va">nCase_bp</span>,</span>
<span>                       trait1_N_control <span class="op">=</span> <span class="va">nControl_sz</span>,</span>
<span>                       trait2_N_control <span class="op">=</span> <span class="va">nControl_bp</span>,</span>
<span>                       AF_case_colname <span class="op">=</span> <span class="st">"true_AF_case"</span>,</span>
<span>                       AF_control_colname <span class="op">=</span> <span class="st">"true_AF_control"</span>,</span>
<span>                       chromosome_colname <span class="op">=</span> <span class="st">"chr"</span>,</span>
<span>                       position_colname <span class="op">=</span> <span class="st">"pos"</span>,</span>
<span>                       id_colname <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>                       A1_colname <span class="op">=</span> <span class="st">"A1"</span>,</span>
<span>                       A2_colname <span class="op">=</span> <span class="st">"A2"</span>,</span>
<span>                       rsid_colname <span class="op">=</span> <span class="st">"RSID"</span>,</span>
<span>                       OR_colname <span class="op">=</span> <span class="st">"OR"</span>,</span>
<span>                       SE_colname <span class="op">=</span> <span class="st">"SE"</span>,</span>
<span>                       N_caseInCase <span class="op">=</span> <span class="va">case_in_case</span>,</span>
<span>                       N_controlInControl <span class="op">=</span> <span class="va">control_in_control</span>,</span>
<span>                       N_caseInControl <span class="op">=</span> <span class="va">case_in_control</span>,</span>
<span>                       Zthreshold <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">CC_GWAS_plot</span><span class="op">(</span>results <span class="op">=</span> <span class="va">res_true_af</span>, title <span class="op">=</span> <span class="st">"SCZ vs BIP All of Us - known AFs"</span><span class="op">)</span></span></code></pre></div>
<p><img src="scz_bp_aou_trueAF_MACFiltered_scale.png"><strong>Figure
3</strong>. Manhattan plot of the CC-GWAS results using the known case
and control AFs for SZ and BP. The red dashed line is the
Bonferroni-corrected genome-wide significance threshold. Chromosome 23
is the X chromosome and chromosome 24 is the Y chromosome.</p>
</div>
<div class="section level4">
<h4 id="using-casecontrol_af">Using CaseControl_AF<a class="anchor" aria-label="anchor" href="#using-casecontrol_af"></a>
</h4>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_af</span> <span class="op">&lt;-</span> <span class="fu">CC_GWAS</span><span class="op">(</span>trait1_data <span class="op">=</span> <span class="va">sz</span>,</span>
<span>                  trait2_data <span class="op">=</span> <span class="va">bp</span>,</span>
<span>                  trait1_N_case <span class="op">=</span> <span class="va">nCase_sz</span>,</span>
<span>                  trait2_N_case <span class="op">=</span> <span class="va">nCase_bp</span>,</span>
<span>                  trait1_N_control <span class="op">=</span> <span class="va">nControl_sz</span>,</span>
<span>                  trait2_N_control <span class="op">=</span> <span class="va">nControl_bp</span>,</span>
<span>                  AF_case_colname <span class="op">=</span> <span class="st">"AF_case"</span>,</span>
<span>                  AF_control_colname <span class="op">=</span> <span class="st">"AF_control"</span>,</span>
<span>                  chromosome_colname <span class="op">=</span> <span class="st">"chr"</span>,</span>
<span>                  position_colname <span class="op">=</span> <span class="st">"pos"</span>,</span>
<span>                  id_colname <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>                  A1_colname <span class="op">=</span> <span class="st">"A1"</span>,</span>
<span>                  A2_colname <span class="op">=</span> <span class="st">"A2"</span>,</span>
<span>                  rsid_colname <span class="op">=</span> <span class="st">"RSID"</span>,</span>
<span>                  OR_colname <span class="op">=</span> <span class="st">"OR"</span>,</span>
<span>                  SE_colname <span class="op">=</span> <span class="st">"SE"</span>,</span>
<span>                  N_caseInCase <span class="op">=</span> <span class="va">case_in_case</span>,</span>
<span>                  N_controlInControl <span class="op">=</span> <span class="va">control_in_control</span>,</span>
<span>                  N_caseInControl <span class="op">=</span> <span class="va">case_in_control</span>,</span>
<span>                  Zthreshold <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">CC_GWAS_plot</span><span class="op">(</span>results <span class="op">=</span> <span class="va">res_af</span>, title <span class="op">=</span> <span class="st">"SCZ vs BIP All of Us - CaseControl_AF"</span><span class="op">)</span></span></code></pre></div>
<p><img src="scz_bp_aou_AF_MACFiltered_scale.png"><strong>Figure
4</strong>. Manhattan plot of the CC-GWAS results using the
CaseControl_AF estimated case and control AFs for SZ and BP. The red
dashed line is the Bonferroni-corrected genome-wide significance
threshold. Chromosome 23 is the X chromosome and chromosome 24 is the Y
chromosome.</p>
</div>
<div class="section level4">
<h4 id="using-casecontrol_se">Using CaseControl_SE<a class="anchor" aria-label="anchor" href="#using-casecontrol_se"></a>
</h4>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_se</span> <span class="op">&lt;-</span> <span class="fu">CC_GWAS</span><span class="op">(</span>trait1_data <span class="op">=</span> <span class="va">sz</span>,</span>
<span>                  trait2_data <span class="op">=</span> <span class="va">bp</span>,</span>
<span>                  trait1_N_case <span class="op">=</span> <span class="va">nCase_sz</span>,</span>
<span>                  trait2_N_case <span class="op">=</span> <span class="va">nCase_bp</span>,</span>
<span>                  trait1_N_control <span class="op">=</span> <span class="va">nControl_sz</span>,</span>
<span>                  trait2_N_control <span class="op">=</span> <span class="va">nControl_bp</span>,</span>
<span>                  AF_case_colname <span class="op">=</span> <span class="st">"MAF_case"</span>,</span>
<span>                  AF_control_colname <span class="op">=</span> <span class="st">"MAF_control"</span>,</span>
<span>                  chromosome_colname <span class="op">=</span> <span class="st">"chr"</span>,</span>
<span>                  position_colname <span class="op">=</span> <span class="st">"pos"</span>,</span>
<span>                  id_colname <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>                  A1_colname <span class="op">=</span> <span class="st">"A1"</span>,</span>
<span>                  A2_colname <span class="op">=</span> <span class="st">"A2"</span>,</span>
<span>                  rsid_colname <span class="op">=</span> <span class="st">"RSID"</span>,</span>
<span>                  OR_colname <span class="op">=</span> <span class="st">"OR"</span>,</span>
<span>                  SE_colname <span class="op">=</span> <span class="st">"SE"</span>,</span>
<span>                  N_caseInCase <span class="op">=</span> <span class="va">case_in_case</span>,</span>
<span>                  N_controlInControl <span class="op">=</span> <span class="va">control_in_control</span>,</span>
<span>                  N_caseInControl <span class="op">=</span> <span class="va">case_in_control</span>,</span>
<span>                  Zthreshold <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">CC_GWAS_plot</span><span class="op">(</span>results <span class="op">=</span> <span class="va">res_se</span>, title <span class="op">=</span> <span class="st">"SCZ vs BIP All of Us - CaseControl_SE"</span><span class="op">)</span></span></code></pre></div>
<p><img src="scz_bp_aou_SE_MACFiltered_scale.png"><strong>Figure
5</strong>. Manhattan plot of the CC-GWAS results using the
CaseControl_SE estimated case and control AFs for SZ and BP. The red
dashed line is the Bonferroni-corrected genome-wide significance
threshold. Chromosome 23 is the X chromosome and chromosome 24 is the Y
chromosome.</p>
<p>QQ-Plot</p>
<p><img src="qq_szbp_all_new_lambda.png"><strong>Figure 6</strong>.
Q-Q Plot for the All of Us Schizophrenia vs Bipolar CC-GWAS. The results
from using the known AFs are shown in green, the results from using
CaseControl_AF estimated AFs are shown in black, and the results from
using CaseControl_SE estimated AFs are shown in purple.</p>
<p>We see that the CaseControl_SE derived MAFs result in slightly
deflated test statistics. Conversely, CaseControl_AF derived AFs results
in inflated test statistics. As expected, the true AFs do not appear to
be inflated.</p>
</div>
<div class="section level3">
<h3 id="replicating-the-resuts-from-yang-et-al">Replicating the resuts from Yang et al<a class="anchor" aria-label="anchor" href="#replicating-the-resuts-from-yang-et-al"></a>
</h3>
<p>As a sanity check, we ensured that we could replicate the results
from the ReACt paper which are shown below. In the paper they used the
summary statistics from the <a href="https://www.med.unc.edu/pgc/download-results/" class="external-link">Psychiatric
Genomics Consortium (PGC)</a>. We are not able to compare the three AFs
(known case and control AFs, CaseControl_AF estimated, CaseControl_SE
estimated) for this dataset as they d0 not include total AF. However, to
ensure that no errors have been made in adapting the code from C to R,
we ensured that we could obtain the same results as published in the
ReACt paper using the code presented here. This is using CaseControl_SE
to estimate the case and control AFs, and subsequently performing
CC-GWAS. These results are nearly identical to those published in the
paper.</p>
<p><img src="manahttan_ReACtrep_szbp.png"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Hayley Wolff.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
